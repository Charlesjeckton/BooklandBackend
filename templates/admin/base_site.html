{% extends "admin/base.html" %}
{% load static %}

{% block extrahead %}
{{ block.super }}
<link rel="manifest" href="{% static 'admin/manifest.json' %}">
<meta name="theme-color" content="#0d6efd">
<style>
  /* Simple button styling */
  #installAdminBtn {
      background-color: #0d6efd;
      color: white;
      border: none;
      padding: 6px 12px;
      margin-left: 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
  }
</style>
{% endblock %}

{% block footer %}
{{ block.super }}
<script>
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;

      const btn = document.createElement('button');
      btn.id = 'installAdminBtn';
      btn.innerText = 'Install Admin App';
      const header = document.querySelector('.module'); // append to admin header area
      if(header) header.prepend(btn);

      btn.style.display = 'inline-block';

      btn.addEventListener('click', async () => {
          btn.style.display = 'none';
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log('Install outcome:', outcome);
          deferredPrompt = null;
      });
  });

  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("{% static 'admin/sw.js' %}");
  }
</script>
{% endblock %}
